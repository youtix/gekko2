import { describe, expect, it } from 'vitest';
import { SMMA } from './smma.indicator';

describe('SMMA', () => {
  const smma2 = new SMMA({ period: 2 });
  it.each`
    candle           | expected
    ${{ close: 81 }} | ${0}
    ${{ close: 24 }} | ${52.5}
    ${{ close: 75 }} | ${63.75}
    ${{ close: 21 }} | ${42.375}
    ${{ close: 34 }} | ${38.1875}
    ${{ close: 25 }} | ${31.59375}
    ${{ close: 72 }} | ${51.796875}
    ${{ close: 92 }} | ${71.8984375}
    ${{ close: 99 }} | ${85.44921875}
    ${{ close: 2 }}  | ${43.724609375}
    ${{ close: 86 }} | ${64.8623046875}
    ${{ close: 80 }} | ${72.43115234375}
    ${{ close: 76 }} | ${74.215576171875}
    ${{ close: 8 }}  | ${41.1077880859375}
    ${{ close: 87 }} | ${64.05389404296875}
    ${{ close: 75 }} | ${69.52694702148438}
    ${{ close: 32 }} | ${50.76347351074219}
    ${{ close: 65 }} | ${57.881736755371094}
    ${{ close: 41 }} | ${49.44086837768555}
    ${{ close: 9 }}  | ${29.220434188842773}
    ${{ close: 13 }} | ${21.110217094421387}
    ${{ close: 26 }} | ${23.555108547210693}
    ${{ close: 56 }} | ${39.77755427360535}
    ${{ close: 28 }} | ${33.88877713680267}
    ${{ close: 65 }} | ${49.44438856840134}
    ${{ close: 58 }} | ${53.72219428420067}
    ${{ close: 17 }} | ${35.361097142100334}
    ${{ close: 90 }} | ${62.68054857105017}
    ${{ close: 87 }} | ${74.84027428552508}
    ${{ close: 86 }} | ${80.42013714276254}
    ${{ close: 99 }} | ${89.71006857138127}
    ${{ close: 3 }}  | ${46.355034285690635}
    ${{ close: 70 }} | ${58.17751714284532}
    ${{ close: 1 }}  | ${29.58875857142266}
    ${{ close: 27 }} | ${28.29437928571133}
    ${{ close: 9 }}  | ${18.647189642855665}
    ${{ close: 92 }} | ${55.32359482142783}
    ${{ close: 68 }} | ${61.661797410713916}
    ${{ close: 9 }}  | ${35.33089870535696}
  `('should correctly calculate SMMAs with period 2 when candle is $candle', ({ candle, expected }) => {
    smma2.onNewCandle(candle);
    expect(smma2.getResult()).to.equal(expected);
  });

  const smma12 = new SMMA({ period: 12 });
  it.each`
    candle           | expected
    ${{ close: 81 }} | ${0}
    ${{ close: 24 }} | ${0}
    ${{ close: 75 }} | ${0}
    ${{ close: 21 }} | ${0}
    ${{ close: 34 }} | ${0}
    ${{ close: 25 }} | ${0}
    ${{ close: 72 }} | ${0}
    ${{ close: 92 }} | ${0}
    ${{ close: 99 }} | ${0}
    ${{ close: 2 }}  | ${0}
    ${{ close: 86 }} | ${0}
    ${{ close: 80 }} | ${57.583333333333336}
    ${{ close: 76 }} | ${59.11805555555556}
    ${{ close: 8 }}  | ${54.858217592592595}
    ${{ close: 87 }} | ${57.536699459876544}
    ${{ close: 75 }} | ${58.991974504886834}
    ${{ close: 32 }} | ${56.74264329614626}
    ${{ close: 65 }} | ${57.430756354800735}
    ${{ close: 41 }} | ${56.06152665856734}
    ${{ close: 9 }}  | ${52.1397327703534}
    ${{ close: 13 }} | ${48.87808837282395}
    ${{ close: 26 }} | ${46.97158100842196}
    ${{ close: 56 }} | ${47.72394925772013}
    ${{ close: 28 }} | ${46.080286819576784}
    ${{ close: 65 }} | ${47.65692958461205}
    ${{ close: 58 }} | ${48.51885211922771}
    ${{ close: 17 }} | ${45.89228110929207}
    ${{ close: 90 }} | ${49.5679243501844}
    ${{ close: 87 }} | ${52.687263987669034}
    ${{ close: 86 }} | ${55.463325322029945}
    ${{ close: 99 }} | ${59.09138154519412}
    ${{ close: 3 }}  | ${54.41709974976128}
    ${{ close: 70 }} | ${55.715674770614505}
    ${{ close: 1 }}  | ${51.15603520639663}
    ${{ close: 27 }} | ${49.14303227253024}
    ${{ close: 9 }}  | ${45.79777958315272}
    ${{ close: 92 }} | ${49.64796461788999}
    ${{ close: 68 }} | ${51.177300899732494}
    ${{ close: 9 }}  | ${47.66252582475479}
  `('should correctly calculate SMMAs with period 12 and $candle candle', ({ candle, expected }) => {
    smma12.onNewCandle(candle);
    expect(smma12.getResult()).to.equal(expected);
  });

  const smma26 = new SMMA({ period: 26 });
  it.each`
    candle           | expected
    ${{ close: 81 }} | ${0}
    ${{ close: 24 }} | ${0}
    ${{ close: 75 }} | ${0}
    ${{ close: 21 }} | ${0}
    ${{ close: 34 }} | ${0}
    ${{ close: 25 }} | ${0}
    ${{ close: 72 }} | ${0}
    ${{ close: 92 }} | ${0}
    ${{ close: 99 }} | ${0}
    ${{ close: 2 }}  | ${0}
    ${{ close: 86 }} | ${0}
    ${{ close: 80 }} | ${0}
    ${{ close: 76 }} | ${0}
    ${{ close: 8 }}  | ${0}
    ${{ close: 87 }} | ${0}
    ${{ close: 75 }} | ${0}
    ${{ close: 32 }} | ${0}
    ${{ close: 65 }} | ${0}
    ${{ close: 41 }} | ${0}
    ${{ close: 9 }}  | ${0}
    ${{ close: 13 }} | ${0}
    ${{ close: 26 }} | ${0}
    ${{ close: 56 }} | ${0}
    ${{ close: 28 }} | ${0}
    ${{ close: 65 }} | ${0}
    ${{ close: 58 }} | ${51.15384615384615}
    ${{ close: 17 }} | ${49.840236686390526}
    ${{ close: 90 }} | ${51.3848429676832}
    ${{ close: 87 }} | ${52.75465669969538}
    ${{ close: 86 }} | ${54.033323749707094}
    ${{ close: 99 }} | ${55.76281129779528}
    ${{ close: 3 }}  | ${53.73347240172623}
    ${{ close: 70 }} | ${54.35910807858291}
    ${{ close: 1 }}  | ${52.3068346909451}
    ${{ close: 27 }} | ${51.333494895139516}
    ${{ close: 9 }}  | ${49.705283553018766}
    ${{ close: 92 }} | ${51.332003416364195}
    ${{ close: 68 }} | ${51.9730802080425}
    ${{ close: 9 }}  | ${50.32026943081009}
  `('should correctly calculate SMMAs with period 26 and $candle candle', ({ candle, expected }) => {
    smma26.onNewCandle(candle);
    expect(smma26.getResult()).to.equal(expected);
  });
});
